---
- name: Deploy Stringer with Docker and Ansible
  hosts: all
  become: yes
  vars:
    project_dir: /opt/stringer

  tasks:
    - name: Install system dependencies
      apt:
        name:
          - docker.io
          - docker-compose
          - git
        state: present
        update_cache: yes
      ignore_errors: yes  # Щоб локальний тест не вимагав sudo пароль в CI

    - name: Ensure project directory exists
      file:
        path: "{{ project_dir }}"
        state: directory
        mode: '0755'

    - name: Copy docker-compose configuration
      copy:
        src: ../docker-compose.yml
        dest: "{{ project_dir }}/docker-compose.yml"

    - name: Pull and start services
      community.docker.docker_compose:
        project_src: "{{ project_dir }}"
        build: yes
        state: present
